<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd">

  <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location" value="classpath:site.properties" />
  </bean>

  <!-- 全 URL　に対して Filter をかける場合の　URL マッピングリスト -->
  <util:list id="fullUrlPattern" list-class="java.util.ArrayList">
    <value>/###allPages###/</value>
    <value>/###allPages###/###allPages###/</value>
    <value>/###allPages###/###allPages###/###allPages###/</value>
    <value>/###allPages###/###allPages###/###allPages###/###allPages###/</value>
    <value>/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/</value>
    <value>/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/</value>
    <value>/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/###allPages###/</value>
  </util:list>

<!--
	フィルターの設定はここに記載すること。
	記述された順番にフィルターが動きます。
 -->

  <!-- リクエストスコープへロードする共通処理 -->
  <bean id="requestScopeBeanLoader" class="jp.co.transcosmos.dm3.utils.AddBeanToRequestScopeCommand">
    <property name="beanMap">
      <map>
        <entry key="codeLookupManager" value-ref="codeLookupManager"/>
        <entry key="commonParameters" value-ref="commonParameters"/>
      </map>
    </property>
  </bean>

  <!-- マイページログインチェックフィルター処理 -->
  <bean id="loginCheckFilter" class="jp.co.transcosmos.dm3.login.command.v3.LoginCheckFilter">
    <property name="authentication" ref="mypageAuth" />
  </bean>

  <!-- マイページソフトログインチェックフィルター処理 -->
  <bean id="softLoginCheckFilter" class="jp.co.transcosmos.dm3.login.command.v3.LoginCheckFilter">
    <property name="authentication" ref="mypageAuth" />
    <property name="softLogin" value="true" />
  </bean>

  <!-- 匿名認証処理を行うフィルター処理 -->
  <bean id="anonymousloginFilter" class="jp.co.transcosmos.dm3.login.command.v3.LoginCheckFilter">
    <property name="authentication" ref="anonymousAuth" />
  </bean>

  <!-- お気に入り件数を設定するフィルター処理 -->
  <bean id="favoriteFilter" class="jp.co.transcosmos.dm3.webFront.filter.FavoriteFilter">
    <property name="favoriteManager" ref="favoriteManage" />
  </bean>

  <!-- 最近見た物件の件数を設定するフィルター処理 -->
  <bean id="recentlyFilter" class="jp.co.transcosmos.dm3.webFront.filter.RecentlyFilter">
    <property name="recentlyInfoDAO" ref="recentlyInfoDAO" />
  </bean>

  <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMappingList">
    <property name="commandURLMapper" ref="commandURLMapper"/>
    <property name="mappings">
      <list>

        <!-- リクエストスコープへ共通処理をロード -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="defaultCommandName" value="requestScopeBeanLoader"/>
          <property name="filter" value="true"/>
        </bean>

        <!-- お気に入り件数を設定する処理 -->
<!-- 2015.06.22 認証情報を参照する処理は、認証処理よりも前には実行できない。
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
              <value>/mypage/login/check/</value>
              <value>/buy/inquiry/division/check/</value>
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="favoriteFilter"/>
          <property name="filter" value="true"/>
        </bean>
-->
        <!-- 最近見た物件の件数を設定する処理 -->
<!-- 2015.06.22 認証情報を参照する処理は、認証処理よりも前には実行できない。
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
              <value>/mypage/login/check/</value>
              <value>/buy/inquiry/division/check/</value>
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="recentlyFilter"/>
          <property name="filter" value="true"/>
        </bean>
-->
        <!-- マイページ認証処理 （Panasonic 版では、ログイン後の画面はリクエスト先になるように変更） -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern">
            <list>
              <value>/mypage/</value>
              <value>/mypage/###allPages###/</value>
              <value>/mypage/###allPages###/###allPages###/</value>
              <value>/mypage/###allPages###/###allPages###/###allPages###/</value>
              <value>/mypage/###allPages###/###allPages###/###allPages###/###allPages###/</value>
            </list>
          </property>
          <property name="exceptionUrlPattern">
            <list>
              <value>/mypage/login/</value>
              <value>/mypage/login/check/</value>
              <value>/mypage/logout/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="loginCheckFilter"/>
          <property name="filter" value="true"/>
          <property name="namedViews">
            <props>
              <prop key="failure">/WEB-INF/jsp/front/login/Login.jsp</prop>
            </props>
          </property>
        </bean>

        <!-- 物件問い合わせ時のマイページログイン認証チェック -->
<!-- 2015.06.22 物件問合せの認証チェックは、件数取得のフィルターの後に実行する。
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern">
            <list>
              <value>/buy/inquiry/division/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="loginCheckFilter"/>
          <property name="filter" value="true"/>
          <property name="namedViews">
            <props>
              <prop key="failure">/WEB-INF/jsp/front/inquiryDivision/inquiryDivision.jsp</prop>
            </props>
          </property>
        </bean>
-->
        <!-- マイページソフトログイン認証処理 -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="softLoginCheckFilter"/>
          <property name="filter" value="true"/>
        </bean>

        <!-- 匿名認証処理 -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="anonymousloginFilter"/>
          <property name="filter" value="true"/>
        </bean>

<!-- 2015.06.22 認証情報を参照する処理は、認証処理よりも前には実行できない。 start -->
        <!-- お気に入り件数を設定する処理 -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
<!--
              <value>/mypage/login/check/</value>
              <value>/buy/inquiry/division/check/</value>
-->
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="favoriteFilter"/>
          <property name="filter" value="true"/>
        </bean>

        <!-- 最近見た物件の件数を設定する処理 -->
        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern" ref="fullUrlPattern" />
          <property name="exceptionUrlPattern">
            <list>
<!--
              <value>/mypage/login/check/</value>
              <value>/buy/inquiry/division/check/</value>
-->
              <value>/health_chk/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="recentlyFilter"/>
          <property name="filter" value="true"/>
        </bean>
<!-- 2015.06.22 認証情報を参照する処理は、認証処理よりも前には実行できない。 end -->

        <bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
          <property name="urlPattern">
            <list>
              <value>/buy/inquiry/division/</value>
            </list>
          </property>
          <property name="defaultCommandName" value="loginCheckFilter"/>
          <property name="filter" value="true"/>
          <property name="namedViews">
            <props>
              <prop key="failure">/WEB-INF/jsp/front/inquiryDivision/inquiryDivision.jsp</prop>
            </props>
          </property>
        </bean>

		<!-- CSRF 対策用 token のチェックフィルター -->
		<bean class="jp.co.transcosmos.dm3.servlet.URLCommandViewMapping">
			<property name="urlPattern">
			  <list>
			    <value>/buy/inquiry/result/</value>
			    <value>/sell/assessment/result/</value>
                <value>/modal/delete/</value>
                <value>/mypage/request/result/</value>
                <value>/mypage/request/delete/result/</value>
                <value>/inquiry/result/</value>
                <value>/event/result/</value>
                <value>/account/member/new/result/</value>
                <value>/mypage/member/change/result/</value>
                <value>/account/pw/forgot/result/</value>
                <value>/account/pw/new/result/###remindId###/</value>
			  </list>
			</property>
			<property name="defaultCommandName" value="csrfChkFilter"/>
			<property name="filter" value="true"/>
		</bean>

      </list>
    </property>
  </bean>

</beans>
